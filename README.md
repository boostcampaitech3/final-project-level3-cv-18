## ğŸ˜Š í”¼ë¶€ í‰ê°€ (XAI) ì‹œìŠ¤í…œ

&nbsp; 
## ğŸ”¥ Member ğŸ”¥
<table>
  <tr height="125px">
    <td align="center" width="120px">
      <a href="https://github.com/kimkihoon0515"><img src="https://avatars.githubusercontent.com/kimkihoon0515"/></a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/ed-kyu"><img src="https://avatars.githubusercontent.com/ed-kyu"/></a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/GwonPyo"><img src="https://avatars.githubusercontent.com/GwonPyo"/></a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/ysw2946"><img src="https://avatars.githubusercontent.com/ysw2946"/></a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/jsh0551"><img src="https://avatars.githubusercontent.com/jsh0551"/></a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/YJ0522771"><img src="https://avatars.githubusercontent.com/YJ0522771"/></a>
    </td>
  </tr>
  <tr height="70px">
    <td align="center" width="120px">
      <a href="https://github.com/kimkihoon0515">ê¹€ê¸°í›ˆ_T3019</a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/ed-kyu">ê¹€ìŠ¹ê·œ_T3037</a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/GwonPyo">ë‚¨ê¶Œí‘œ_T3072</a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/ysw2946">ìœ ìŠ¹ìš°_T3130</a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/jsh0551">ì¥ìˆ˜í˜¸_T3185</a>
    </td>
    <td align="center" width="120px">
      <a href="https://github.com/YJ0522771">ì¡°ìœ ì§„_T3208</a>
    </td>
  </tr>
</table>

&nbsp; 

## ğŸ”Project Overview

- ì„œë¹„ìŠ¤ ë°°ê²½ ë° ëª©í‘œ

  <img src=".\readme_file\overview.jpg" alt="overview" style="zoom: 50%;" />

ì•„ì§ê¹Œì§€ ì‚¬ëŒë“¤ì€ í”¼ë¶€ë¥¼ ì§„ë‹¨í•˜ê³  ì§€ì†ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ í”¼ë¶€ê³¼ë¥¼ ë°©ë¬¸í•˜ê³  ë¹„ì‹¼ ë¹„ìš©ì„ ì§€ë¶ˆí•´ì•¼ í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¬¼ë¦¬ì  ì œì•½ì„ ì—†ì• ê³ ì, ê°„ë‹¨í•˜ê²Œ í”¼ë¶€ë¥¼ ì§„ë‹¨í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©ìë“¤ì—ê²Œ í¸ì˜ì„±ì„ ì œê³µí•˜ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ë¥¼ ê¸°íší•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ í”¼ë¶€ ì§„ë‹¨ ì„œë¹„ìŠ¤ì˜ ëª©í‘œëŠ” ìŠ¤ë§ˆíŠ¸í° í˜¹ì€ ì›¹ìº ì„ í†µí•´ ì–¼êµ´ ì‚¬ì§„ì„ ì´¬ì˜í•˜ì—¬, ê° í•­ëª©ì— ëŒ€í•œ ì ìˆ˜ì™€ ì´ì— ëŒ€í•œ ì‹œê°ì  ê·¼ê±°ë¥¼ í•¨ê»˜ ì œê³µí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.



<img src=".\readme_file\structure.jpg" alt="structure" style="zoom:50%;" />

* Frontend
  * Userì˜ IDì™€ passwordë¥¼ ì…ë ¥í•˜ë©´ ê°œì¸ í”¼ë¶€ ì‚¬ì§„ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŒ
  * ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´ í”¼ë¶€ í‰ê°€ ì ìˆ˜ì™€ gradcamì„ ì œê³µ
  * í‰ê°€ ì ìˆ˜ê°€ ì €ì¥ë˜ì–´ í”¼ë¶€ ë³€í™” ì¶”ì´ë¥¼ ê·¸ë˜í”„ë¡œ í™•ì¸ ê°€ëŠ¥
* Backend
  * FastAPIë¡œ ëª¨ë¸ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ì—¬ í‰ê°€ ì ìˆ˜ì™€ gradcamì„ ë¹ ë¥´ê²Œ ê³„ì‚°í•˜ì—¬ ì œê³µ
  * SQLiteë¡œ ì‚¬ìš©ìë“¤ì˜ ë°ì´í„° ì •ë³´ë¥¼ ì €ì¥



## ğŸ§±Structure

â”œâ”€â”€ backend     
â”‚  â”œâ”€â”€backend.py      
â”‚  â”œâ”€â”€ fast.py      
â”‚  â”œâ”€â”€ fast1.py     
â”‚  â”œâ”€â”€ grad_cam.py      
â”‚  â”œâ”€â”€ image_crop.py      
â”‚  â””â”€â”€ prediction.py      
â”‚       
â”œâ”€â”€ baseline      
â”‚  â”œâ”€â”€ dataset.py     
â”‚  â”œâ”€â”€ evaluation.py      
â”‚  â”œâ”€â”€ loss.py      
â”‚  â”œâ”€â”€ model.py     
â”‚  â”œâ”€â”€ train.py     
â”‚ â””â”€â”€ utils.py      
â”‚       
â”œâ”€â”€ EDA     
â”‚  â””â”€â”€ EDA.ipynb      
â”‚       
â””â”€â”€ frontend      
    â”œâ”€â”€ logo          
   â””â”€â”€ prototype.py       



## ğŸ‘©â€ğŸ«ê°œë°œ í™˜ê²½
- GPUí™˜ê²½ : V100 ì„œë²„, Google Cloud Platform(GCP) ì„œë²„

- íŒ€ í˜‘ë ¥ Tools : Notion, Weights&Biases, Github, Google Drive, MLflow

- ê°œë°œ Tools : VScode, Jupyter Lab

- ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° í”„ë ˆì„ì›Œí¬ : PyTorch, Streamlit

  

## ğŸ—‚ï¸Dataset

- í”¼ë¶€ë¥¼ ìœ ë¶„, ìˆ˜ë¶„, ì£¼ë¦„, ìƒ‰ì†Œ, ë¯¼ê°ë„ 5ê°€ì§€ í•­ëª©ìœ¼ë¡œ ë‚˜ëˆ„ê³ , ì •ë„ì— ë”°ë¼ 0ë¶€í„° 4ê¹Œì§€ í‰ê°€í•œ í”¼ë¶€ ë°ì´í„°<img src=".\readme_file\data.jpg" alt="data" style="zoom: 80%;" />

- ê° í•­ëª©ì˜ ì¼ë¶€ ë¼ë²¨ì´ ë§¤ìš° ë¶€ì¡±í•œ imbalance data

- ë³´ì•ˆ ê·œì • ìƒ í”¼ë¶€ ì´ë¯¸ì§€, ë°ì´í„° ìˆ˜, ë¼ë²¨ë§ ê¸°ì¤€ ë“±ì€ ê³µê°œ ë¶ˆê°€

  

## ğŸ‘¨â€ğŸ«í‰ê°€ Metric

- Penalty Recall(P-Recall)

<img src=".\readme_file\precall.jpg" alt="precall" style="zoom: 67%;" />

- Ordinal dataì´ê¸° ë•Œë¬¸ì— ì •ë‹µë§Œ ë§ì¶”ëŠ” ê²ƒ ë¿ ì•„ë‹ˆë¼ ì •ë‹µê³¼ ì–¼ë§ˆë‚˜ ë¹„ìŠ·í•˜ê²Œ ì˜ˆì¸¡í–ˆëŠ”ì§€ë„ ì¤‘ìš”í•¨

- ì •ë‹µê³¼ ì¸ì ‘í•œ ë¼ë²¨ë¡œ ì˜ˆì¸¡í•˜ë©´ ì¼ì • ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬í•œ ì •ë‹µìœ¼ë¡œ ì¸ì •í•˜ê³ , ì •ë‹µê³¼ ë¨¼ ë¼ë²¨ë¡œ ì˜ˆì¸¡í•˜ë©´ íŒ¨ë„í‹°ë¥¼ ì£¼ì–´ recallì„ ê³„ì‚°

  

## ğŸ§ªExperiments

- Model(P-Recall)

  |                  | Parameters | Metric           | Training Time |
  | ---------------- | ---------- | ---------------- | ------------- |
  | Swin V2          | 88M        | P-Recall: 0.5331 | 13m 45s       |
  | Swin Transformer | 28.3M      | P-Recall:0.5822  | 16m 01s       |
  | Twin             | 43.8M      | P-Recall: 0.5435 | 13m 37s       |
  | EfficientNet-B4  | 19M        | P-Recall: 0.4084 | 9m 56s        |
  | EfficientNet-B0  | 5.3M       | P-Recall: 0.5002 | 5m 4s         |

  ì„œë¹„ìŠ¤ë¥¼ í•˜ê¸° ìœ„í•´ ëª¨ë¸ì˜ ì„±ëŠ¥ ë¿ ì•„ë‹ˆë¼ ì†ë„ì™€ í¬ê¸°ë„ ê³ ë ¤í•˜ì—¬ EfficientNet-B0ë¡œ ìµœì¢… ê²°ì •

- Loss(P-Recall)

  |      | Cross Entropy                        | label Smoothing CE                                       | Focal                                                        | Class Balanced Softmax CE*                                | Class Balanced Focal*                                     |
  | ---- | ------------------------------------ | -------------------------------------------------------- | ------------------------------------------------------------ | -------------------------------------------------------- | -------------------------------------------------------- |
  | ì„¤ëª… | ë‹¤ì¤‘ ë¶„ë¥˜ë¥¼ ìœ„í•œ ì†ì‹¤ í•¨ìˆ˜(Baseline) | Soft targetìœ¼ë¡œ ë°”ê¾¸ì–´ ì •ë‹µê³¼ ì˜¤ë‹µê°„ì˜ score ê²©ì°¨ë¥¼ ì¤„ì„ | ì–´ë µê±°ë‚˜ ì‰½ê²Œ ì˜¤ë¶„ë¥˜ë˜ëŠ” ì¼€ì´ìŠ¤ì— ë” í° ê°€ì¤‘ì¹˜ë¥¼ ì£¼ì–´ ë¶ˆê· í˜• ë¬¸ì œë¥¼ ê°œì„  | ìƒˆë¡œìš´ ì¼€ì´ìŠ¤ë¥¼ í•™ìŠµí•  ë•Œ ê°€ì¤‘ì¹˜ë¥¼ ì£¼ì–´ ë¶ˆê· í˜• ë¬¸ì œ ê°œì„  | ìƒˆë¡œìš´ ì¼€ì´ìŠ¤ë¥¼ í•™ìŠµí•  ë•Œ ê°€ì¤‘ì¹˜ë¥¼ ì£¼ì–´ ë¶ˆê· í˜• ë¬¸ì œ ê°œì„  |

  | Loss function             | Oil     | Sensitive | Wrinkle | Pigmentation | Hydration |
  | ------------------------- | ------- | --------- | ------- | ------------ | --------- |
  | Baseline (Cross Entropy)  | 0.7501  | 0.456     | 0.3425  | 0.687        | 0.4726    |
  | Label Smoothing CE (0.1)  | 0.755   | 0.3545    | ğŸ”¹0.4113 | ğŸ”¹0.6934      | ğŸ”¹0.4908   |
  | Focal                     | 0.7627  | 0.3894    | 0.3356  | 0.682        | 0.4823    |
  | Class Balanced Softmax CE* | ğŸ”¹0.7246 | 0.5706    | 0.3618  | 0.6742       | 0.4598    |
  | Class Balanced Focal*      | 0.746   | ğŸ”¹0.5894   | 0.3708  | 0.6522       | 0.4617    |

>  *https://arxiv.org/abs/1901.05555

  ê° í•­ëª© ë³„ ê°€ì¥ ë†’ì€ P-Recallì„ ë‹¬ì„±í•œ loss fuctionì„ ì‚¬ìš©

* Masked Label Smoothing(P-Recall)

>  https://arxiv.org/abs/2203.02889

  * ë‹¤ë¥¸ ë¼ë²¨ê³¼ì˜ score ê²©ì°¨ë¥¼ ì¤„ì—¬ì£¼ëŠ” Label Smoothingì˜ íŠ¹ì„±ì„ ì ìš©í•˜ì—¬, ì¸ì ‘í•œ ë¼ë²¨ì—ë§Œ í™•ë¥ ì„ ë°°ë¶„

  <img src=".\readme_file\mls.jpg" alt="mls" style="zoom:67%;" />

<img src=".\readme_file\msl_hydration.jpg" alt="msl_hydration" style="zoom:50%;" />

<img src=".\readme_file\msl_pigmentation.jpg" alt="msl_pigmentation" style="zoom:50%;" />

<img src=".\readme_file\msl_wrinkle.jpg" alt="msl_wrinkle" style="zoom:50%;" />

- Imbalanced Data Sampler(P-Recall)

>  https://github.com/ufoym/imbalanced-dataset-sampler

  <img src=".\readme_file\sampler.jpg" alt="sampler" style="zoom:80%;" />

  ë¹„ìœ¨ì´ ë†’ì€ ë¼ë²¨ì€ undersampling, ë¹„ìœ¨ì´ ë‚®ì€ ë¼ë²¨ì€ oversamplingí•˜ì—¬ í•™ìŠµ

  |      | Oil                                             | Wrinkle                                         | Sensitive                                       | Pigmentation | Hydration |
  | ---- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- | ------------ | --------- |
  |      | 0.5879                                          | 0.4113                                          | 0.456                                           | 0.6934       | 0.4902    |
  |      | &#x1F539;<span style="color:blue">0.6207</span> | &#x1F539;<span style="color:blue">0.4177</span> | &#x1F539;<span style="color:blue">0.5551</span> | 0.6856       | 0.4701    |

  Oil,Wrinkle,Sensitiveì˜ ê²½ìš° P-Recallì´ ì¦ê°€

  <span style="color:blue">

  </span>

- Augmentation(P-Recall)

  |                              | Oil                                             | Wrinkle                                         | Sensitive                                       | Pigmentation                                    | Hydration                                       |
  | ---------------------------- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |
  | Resize(512,512)(Baseline)    | 0.5879                                          | 0.4113                                          | 0.2702                                          | 0.6934                                          | 0.4908                                          |
  | Resize(1024,1024)            | 0.7552                                          | 0.3800                                          | 0.7547 | &#x1F539;<span style="color:blue">0.8018</span> | 0.2022                                          |
  | CenterCrop(512,512)          | 0.6286                                          | 0.2765                                          | 0.3815                                          | 0.6671                                          | 0.4686                                          |
  | RandomCrop(512,512)          | 0.7516                                          | <span style="color:blue">&#x1F539;0.4480</span> | 0.6782                                          | <span style="color:blue">&#x1F539;0.7460</span> | 0.4745                                          |
  | RandomResizedCrop(512,512)   | 0.6580                                          | 0.3283                                          | 0.4560                                          | 0.7324                                          | <span style="color:blue">&#x1F539;0.5125</span> |
  | RandomResizedCrop(1024,1024) | <span style="color:blue">&#x1F539;0.7631</span> | 0.4213                                          | <span style="color:blue">&#x1F539;0.7568</span>                                         | 0.7803                                          | 0.2181                                          |

  |                   | Oil                                             | Wrinkle | Sensitive                                       | Pigmentation                                    | Hydration                                       |
  | ----------------- | ----------------------------------------------- | ------- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |
  | RGBShift          | &#x1F539;<span style="color:blue">0.6197</span> | 0.4037  | <span style="color:blue">&#x1F539;0.2801</span>                                          | <span style="color:blue">&#x1F539;0.7078</span> | <span style="color:blue">&#x1F539;0.5385</span> |
  | ISONoise          | <span style="color:blue">&#x1F539;0.6416</span> | 0.3651  | &#x1F539;<span style="color:blue">0.4452</span> | 0.6920                                          | <span style="color:blue">&#x1F539;0.5035                                          |
  | OpticalDistortion | <span style="color:blue">&#x1F539;0.6441</span> | 0.3613  | <span style="color:blue">&#x1F539;0.3407</span>                                           | <span style="color:blue">&#x1F539;0.7151</span> | 0.4390                                          |
  | RandomBrightness  | <span style="color:blue">&#x1F539;0.6115</span> | <span style="color:blue">&#x1F539;0.4175</span>   | 0.2681                                          | 0.6904                                          | 0.4653                                          |
  | HorizontalFlip    | &#x1F539;<span style="color:blue">0.6516</span> | 0.3642  | <span style="color:blue">&#x1F539;0.2733</span> | 0.6768                                          | 0.4637                                          |

  Augmentation ì‹¤í—˜ì€ ë‹¤ìŒ ë‘ ê°€ì§€ ê´€ì ì—ì„œ ì§„í–‰

  1) ì£¼ì–´ì§„ ë°ì´í„°ë“¤ì˜ í¬ê¸°ì™€ ì¢…íš¡ë¹„ê°€ ë‹¤ë¥´ë¯€ë¡œ í•´ìƒë„ì™€ ë¹„ìœ¨ì— ëŒ€í•œ ì˜í–¥ì„ ì‹¤í—˜
  2) í”¼ë¶€ë¥¼ ì´¬ì˜í•˜ëŠ” í™˜ê²½ ì°¨ì´ë¥¼ ê³ ë ¤í•œ ì‹¤í—˜

  

  

## ğŸ†Result

- ìµœì¢… ê²°ê³¼(P-Recall)

  - ê° í•­ëª©ë³„ë¡œ P-Recallì— ì˜í–¥ì„ ì£¼ì—ˆë˜ ê¸°ë²•ë“¤ì„ ëª¨ë‘ ì ìš©í•˜ì—¬ ìµœì¢… ëª¨ë¸ í•™ìŠµ

  |                   | Oil                                                          | Wrinkle                                        | Sensitive                         | Pigmentation                           | Hydration                             |
  | ----------------- | ------------------------------------------------------------ | ---------------------------------------------- | --------------------------------- | -------------------------------------- | ------------------------------------- |
  | Loss fuction      | focal                                                        | Masked Label Smoothing                         | Class Balanced Focal              | Masked Label Smoothing                 | Masked Label Smoothing                |
  | Augmentations     | RandomResizedCrop, RGBShift,ISONoise, OpticalDistortion, RandomBrightness, Horizontal Flip | RandomCrop, RGBShift, RandomBrightnessContrast | ResizedCrop, RGBShift, ISONoise, OpticalDistortion, Horizontal Flip | Resize, RandomCrop, RGBshift, ISONoise | RandomResizedCrop, RGBshift, ISONoise |
  | Baseline P-Recall | 0.5879                                                       | 0.4113                                         | 0.4560                            | 0.6934                                 | 0.4908                                |
  | **P-Recall**      | **0.7674**                                                   | **0.6524**                                     | **0.7852**                        | **0.8278**                             | **0.5859**                            |

  

- baseline -> ìµœì¢… ëª¨ë¸

<img src=".\readme_file\result2.jpg" alt="result2" style="zoom:67%;" />

- ì‹œì—° ì˜ìƒ

https://www.youtube.com/watch?v=nDWqPPHq6UQ
 
- ë°ëª¨ ì‚¬ì´íŠ¸
  
https://share.streamlit.io/kimkihoon0515/streamlit_demo/prototype.py
